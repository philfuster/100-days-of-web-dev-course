<%- include('../shared/includes/head.ejs', { title: 'Maintain Orders' }) %>
<link rel="stylesheet" href="/styles/order.css">
<script src="/scripts/order.js" defer></script>
<meta name="csrf-token", content="<%= csrfToken%>">
</head>
<body>
  <%-include('../shared/includes/header.ejs') %>
  <main>
    <% if (orders.length < 1) { %>
    <h1>No Orders.</h1>
    <% } else { %>
      <section id="orders">
        <h1>All Your Orders</h1>
        <% for (const order of orders) { %>
          <section class="order">
            <div class="order-summary">
              <p><span class="order-price" ><%= order.formattedTotalPrice %></span> - <span class="order-date"><%= order.formattedDate %></span></p>
              <span id="order-status-<%= order.id%>" class="order-status"><%= order.status %></span>
            </div>
            <address>
              <p class="user-name"><%= order.user.fullName %></p>
              <p><%= order.user.street%> (<%= order.user.postalCode %> <%= order.user.city%>)</p>
            </address>
            <div class="order-detail">
              <ul>
                <% for(const item of order.items) { %>
                  <li>
                    <span class="item-name"><%= item.name %></span>
                    -
                    <span class="item-total-price"><%= item.formattedTotalPrice%></span>
                    <span class="item-unit-price">(<%= item.formattedPrice %> x <%= item.quantity %>)</span>
                  </li>
                <% } %>
              </ul>
            </div>
            <div class="order-actions">
              <select name="order-status-select-<%= order.id %>" id="order-status-select-<%= order.id %>" class="order-status-select">
                <option value="PENDING">Pending</option>
                <option value="FULFILLED">Fulfilled</option>
                <option value="CANCELED">Canceled</option>
              </select>
              <button data-orderid="<%= order.id%>" id="update-order-status-btn-<%= order.id%>" class="btn btn-secondary update-order-status-btn">Update</button>
            </div>
          </section>
        <% } %>
      </section>
    <% } %>
  </main>
</body>
</html>
